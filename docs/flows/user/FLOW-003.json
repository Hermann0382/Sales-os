{
  "id": "FLOW-003",
  "name": "Execute M2 Current State Mapping",
  "description": "Sales agent maps the prospect's operational reality to expose fragility without judgment. Longest milestone at 15-20 minutes.",
  "feature_id": "FR-002",
  "story_ids": ["ST-004"],
  "actor": "user",
  "trigger": "M1 completed, agent proceeds to M2",
  "steps": [
    {
      "id": "STEP-001",
      "sequence": 1,
      "action": "System displays M2 milestone panel with objective and time indicator (15-20 min)",
      "actor": "system",
      "inputs": ["call_session_id", "milestone_id"],
      "outputs": ["milestone_ui_rendered", "timer_started"],
      "conditions": [],
      "next_steps": ["STEP-002"]
    },
    {
      "id": "STEP-002",
      "sequence": 2,
      "action": "Capture client count (numeric field)",
      "actor": "user",
      "inputs": ["client_count_number"],
      "outputs": ["client_count_recorded"],
      "conditions": [],
      "next_steps": ["STEP-003"]
    },
    {
      "id": "STEP-003",
      "sequence": 3,
      "action": "Assess revenue volatility (1-5 scale)",
      "actor": "user",
      "inputs": ["revenue_volatility_rating"],
      "outputs": ["volatility_recorded"],
      "conditions": [],
      "next_steps": ["STEP-004"]
    },
    {
      "id": "STEP-004",
      "sequence": 4,
      "action": "Select main pain points (multi-select: Storno/chaos/instability)",
      "actor": "user",
      "inputs": ["main_pain_selections"],
      "outputs": ["pain_points_recorded"],
      "conditions": [],
      "next_steps": ["STEP-005"]
    },
    {
      "id": "STEP-005",
      "sequence": 5,
      "action": "Cover client handling patterns",
      "actor": "user",
      "inputs": ["client_handling_notes"],
      "outputs": ["client_handling_covered"],
      "conditions": [],
      "next_steps": ["STEP-006"]
    },
    {
      "id": "STEP-006",
      "sequence": 6,
      "action": "Cover revenue stability discussion",
      "actor": "user",
      "inputs": ["revenue_stability_notes"],
      "outputs": ["revenue_stability_covered"],
      "conditions": [],
      "next_steps": ["STEP-007"]
    },
    {
      "id": "STEP-007",
      "sequence": 7,
      "action": "Cover operations discussion",
      "actor": "user",
      "inputs": ["operations_notes"],
      "outputs": ["operations_covered"],
      "conditions": [],
      "next_steps": ["STEP-008"]
    },
    {
      "id": "STEP-008",
      "sequence": 8,
      "action": "Cover psychological load discussion",
      "actor": "user",
      "inputs": ["psychological_load_notes"],
      "outputs": ["psychological_load_covered"],
      "conditions": [],
      "next_steps": ["STEP-009"]
    },
    {
      "id": "STEP-009",
      "sequence": 9,
      "action": "System generates summary for agent to verbalize back",
      "actor": "system",
      "inputs": ["all_m2_data"],
      "outputs": ["current_state_summary"],
      "conditions": [],
      "next_steps": ["STEP-010"]
    },
    {
      "id": "STEP-010",
      "sequence": 10,
      "action": "Agent verbalizes summary back to prospect",
      "actor": "user",
      "inputs": [],
      "outputs": ["summary_delivered_checkbox"],
      "conditions": [],
      "next_steps": ["STEP-011"]
    },
    {
      "id": "STEP-011",
      "sequence": 11,
      "action": "Add additional notes if needed",
      "actor": "user",
      "inputs": ["milestone_notes"],
      "outputs": ["notes_saved"],
      "conditions": [],
      "next_steps": ["STEP-012"]
    },
    {
      "id": "STEP-012",
      "sequence": 12,
      "action": "System validates required coverage areas",
      "actor": "system",
      "inputs": ["client_count", "revenue_volatility", "main_pain", "coverage_checklist"],
      "outputs": ["milestone_validation_result"],
      "conditions": [
        {
          "condition": "required_fields_incomplete",
          "outcome": "block_or_warn_based_on_mode"
        }
      ],
      "next_steps": ["STEP-013"]
    },
    {
      "id": "STEP-013",
      "sequence": 13,
      "action": "Agent marks M2 complete and proceeds to M3",
      "actor": "user",
      "inputs": [],
      "outputs": ["milestone_status_complete", "next_milestone_activated"],
      "conditions": [],
      "next_steps": []
    }
  ],
  "success_criteria": [
    "Client count captured numerically",
    "Revenue volatility rated 1-5",
    "Main pain points selected from predefined options",
    "All 4 coverage areas discussed (client handling, revenue, ops, psychological)",
    "Summary verbalized back to prospect",
    "M2 complete within 15-20 minutes"
  ],
  "error_handling": [
    {
      "error": "Objection raised during mapping",
      "response": "Trigger objection subflow, return to M2 after resolution"
    },
    {
      "error": "Coverage area missed",
      "response": "Highlight uncovered areas, require completion or override with reason"
    }
  ]
}
