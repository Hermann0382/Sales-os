{
  "id": "FLOW-022",
  "name": "Configure AI Prompts",
  "description": "Admin manages AI prompts across all 5 layers with versioning, variable support, and language variants.",
  "feature_id": "FR-016",
  "story_ids": ["ST-034"],
  "actor": "admin",
  "trigger": "Admin navigates to AI prompt configuration from admin panel",
  "steps": [
    {
      "id": "STEP-001",
      "sequence": 1,
      "action": "Admin navigates to Admin Configuration Panel",
      "actor": "user",
      "inputs": [],
      "outputs": ["admin_panel_loaded"],
      "conditions": [],
      "next_steps": ["STEP-002"]
    },
    {
      "id": "STEP-002",
      "sequence": 2,
      "action": "System verifies admin role",
      "actor": "system",
      "inputs": ["user_role"],
      "outputs": ["access_granted"],
      "conditions": [
        {
          "condition": "role != admin",
          "outcome": "access_denied"
        }
      ],
      "next_steps": ["STEP-003"]
    },
    {
      "id": "STEP-003",
      "sequence": 3,
      "action": "Select AI Prompt Registry section",
      "actor": "user",
      "inputs": [],
      "outputs": ["prompt_registry_loaded"],
      "conditions": [],
      "next_steps": ["STEP-004"]
    },
    {
      "id": "STEP-004",
      "sequence": 4,
      "action": "System displays prompts organized by scope",
      "actor": "system",
      "inputs": [],
      "outputs": ["prompt_list_by_scope"],
      "conditions": [],
      "next_steps": ["STEP-005"]
    },
    {
      "id": "STEP-005",
      "sequence": 5,
      "action": "Select prompt scope (Global, Milestone, Objection, Slide, Analysis)",
      "actor": "user",
      "inputs": ["scope_selection"],
      "outputs": ["scope_prompts_displayed"],
      "conditions": [],
      "next_steps": ["STEP-006"]
    },
    {
      "id": "STEP-006",
      "sequence": 6,
      "action": "Select specific prompt to edit or create new",
      "actor": "user",
      "inputs": ["prompt_id"],
      "outputs": ["prompt_editor_loaded"],
      "conditions": [],
      "next_steps": ["STEP-007"]
    },
    {
      "id": "STEP-007",
      "sequence": 7,
      "action": "Edit prompt text (English version)",
      "actor": "user",
      "inputs": ["prompt_text_en"],
      "outputs": ["en_text_updated"],
      "conditions": [],
      "next_steps": ["STEP-008"]
    },
    {
      "id": "STEP-008",
      "sequence": 8,
      "action": "Edit prompt text (German version)",
      "actor": "user",
      "inputs": ["prompt_text_de"],
      "outputs": ["de_text_updated"],
      "conditions": [],
      "next_steps": ["STEP-009"]
    },
    {
      "id": "STEP-009",
      "sequence": 9,
      "action": "Configure variable placeholders",
      "actor": "user",
      "inputs": ["variable_definitions"],
      "outputs": ["variables_updated"],
      "conditions": [],
      "next_steps": ["STEP-010"]
    },
    {
      "id": "STEP-010",
      "sequence": 10,
      "action": "System validates variable syntax",
      "actor": "system",
      "inputs": ["prompt_text", "variable_definitions"],
      "outputs": ["syntax_validation_result"],
      "conditions": [
        {
          "condition": "invalid_syntax",
          "outcome": "show_syntax_error"
        }
      ],
      "next_steps": ["STEP-011"]
    },
    {
      "id": "STEP-011",
      "sequence": 11,
      "action": "If milestone/objection scope, link to specific entity",
      "actor": "user",
      "inputs": ["milestone_id_or_objection_id"],
      "outputs": ["entity_linked"],
      "conditions": [],
      "next_steps": ["STEP-012"]
    },
    {
      "id": "STEP-012",
      "sequence": 12,
      "action": "Set prompt status (draft, active, deprecated)",
      "actor": "user",
      "inputs": ["prompt_status"],
      "outputs": ["status_updated"],
      "conditions": [],
      "next_steps": ["STEP-013"]
    },
    {
      "id": "STEP-013",
      "sequence": 13,
      "action": "Preview prompt with sample data",
      "actor": "user",
      "inputs": ["sample_data"],
      "outputs": ["preview_rendered"],
      "conditions": [],
      "next_steps": ["STEP-014"]
    },
    {
      "id": "STEP-014",
      "sequence": 14,
      "action": "Save as new version",
      "actor": "user",
      "inputs": [],
      "outputs": ["version_created"],
      "conditions": [],
      "next_steps": ["STEP-015"]
    },
    {
      "id": "STEP-015",
      "sequence": 15,
      "action": "Activate new version (deactivates previous)",
      "actor": "user",
      "inputs": ["activation_confirmation"],
      "outputs": ["version_activated"],
      "conditions": [],
      "next_steps": ["STEP-016"]
    },
    {
      "id": "STEP-016",
      "sequence": 16,
      "action": "System logs execution for traceability",
      "actor": "system",
      "inputs": ["prompt_id", "version", "admin_id", "timestamp"],
      "outputs": ["audit_log_created"],
      "conditions": [],
      "next_steps": ["STEP-017"]
    },
    {
      "id": "STEP-017",
      "sequence": 17,
      "action": "Rollback to previous version if needed",
      "actor": "user",
      "inputs": ["rollback_version"],
      "outputs": ["rollback_completed"],
      "conditions": [],
      "next_steps": []
    }
  ],
  "success_criteria": [
    "5 prompt scopes accessible (Global, Milestone, Objection, Slide, Analysis)",
    "Versioned prompts with status tracking",
    "Language-specific prompts (DE/EN)",
    "Variable placeholders for runtime injection",
    "Logged execution for traceability",
    "Rollback capability",
    "Preview with sample data",
    "AI behavior governable without code changes"
  ],
  "error_handling": [
    {
      "error": "Invalid variable syntax",
      "response": "Highlight syntax error, prevent save"
    },
    {
      "error": "Missing language variant",
      "response": "Warn admin, allow save with incomplete translations"
    },
    {
      "error": "Activation conflict",
      "response": "Confirm deactivation of previous version before proceeding"
    }
  ]
}
